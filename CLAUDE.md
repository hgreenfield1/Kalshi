# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a baseball trading bot for Kalshi prediction markets that uses MLB statistics to calculate win probabilities and execute trading strategies. The system consists of two main components:

1. **Live Trading System** (`Baseball/main.py`) - Real-time trading on active baseball games
2. **Backtesting Framework** (`Baseball/Backtest/`) - Historical strategy testing and analysis

## Core Architecture

### Baseball Module
- `BaseballGame.py` - Core game state management using MLB Stats API
- `TradingStrategy.py` - Abstract base classes for trading strategies
- `strategy.py` - Live trading strategy implementation
- `win_calculator.py` - Win probability calculations using baseballstats library
- `lookup.py` - MLB team mappings and reference data
- `date_helpers.py` - Timestamp and date conversion utilities

### Infrastructure Module
- `Clients/` - HTTP and WebSocket client implementations for Kalshi API
- `market.py` - Market data structure and parsing
- `state.py` - Trading state management
- `ordermanager/` - Order execution and management

### Backtesting System
- `BacktestRunner.py` - Executes strategies against historical data
- `Strategies/backtest_strategies.py` - Backtest-specific strategy implementations
- `analyze.py` - Performance analysis and metrics
- `backtest.py` - Main backtesting entry point

## Key Dependencies

Based on imports and usage patterns:
- `statsapi` - MLB Stats API for real-time game data
- `asyncio` - Asynchronous operations for live trading
- Standard libraries: `logging`, `datetime`, `csv`, `pathlib`

## Development Commands

This project appears to be a Python application without standard package management files. Common development tasks:

```bash
# Run live trading (requires API credentials)
python Baseball/main.py

# Run backtesting
python Baseball/Backtest/backtest.py

# Run analysis on backtest results
python Baseball/Backtest/analyze.py
```

## Architecture Notes

### Game State Management
- Games are identified by parsing Kalshi market tickers (format: KXMLBGAME-DDMMMYY{TEAMS}-{HOME_TEAM})
- Game state updates use MLB Stats API with timestamp support for backtesting
- Win probabilities calculated using situational baseball statistics (inning, outs, runners, score)

### Trading Flow
1. Market data fetched from Kalshi API
2. Game state updated from MLB Stats API
3. Win probability calculated using current game situation
4. Trading signal generated by strategy
5. Orders executed through Kalshi API

### Backtesting Architecture
- Historical market data retrieved via Kalshi candlestick API
- Game states reconstructed using historical MLB data with timestamps
- Strategy performance tracked with detailed logs
- Results exported to CSV files for analysis

## Important Implementation Details

### Market Ticker Parsing
Market tickers encode game date, teams, and home team indicator. The parsing logic handles:
- Date conversion from DDMMMYY format
- Team abbreviation extraction
- Doubleheader game detection (G1/G2 suffixes)

### Win Probability Calculation
Uses situational win probability model based on:
- Current inning and half-inning
- Number of outs
- Runners on base (encoded as integer 1-8)
- Score differential
- Home field advantage

### Strategy Framework
- Abstract base class `TradingStrategy` defines interface
- Separate implementations for live trading vs backtesting
- Position tracking with long/short support
- Trade logging and performance metrics

## Data Files

- `win_probs.txt` - Situational win probability lookup table
- `probability_predictions_v*.csv` - Backtest prediction logs
- `henry.txt` - Configuration or notes file